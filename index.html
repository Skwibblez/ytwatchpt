<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css">
    <title>Socket.IO chat</title>
    <!-- <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: 0.5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
    </style> -->
  </head>
  <body>
    <ul id="messages"></ul>
    <div class = "flex-container">
        <div>
          <iframe title="YouTube video player" id ="ytvid" class="youtube-player" type="text/html" width="720" height="480"
           src="https://www.youtube.com/embed/M68OwnWhEqY?autoplay=1&loop=1"
          frameborder="0" allow="autoplay"allowFullScreen></iframe>
          <input id = "vidDisplay" type = "button" value="Hide" onclick="videoDisplay()"/>
        </div>

        <div>
          <table id="myTableData"  border="1" cellpadding="2">
              <tr>
                  <td>&nbsp;</td>
                  <td><b>User</b></td>
                  <td><b>Song</b></td>
                  <td><b>Link</b></td>
                  <td><b>Play </b></td>
                  <td><b>Delete Song</b></td>
              </tr>
          </table>
        </div>
    </div>

    <form action="">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>

    <form action="">
      <input id="v" autocomplete="off" /><button>Video</button>
    </form>

    <script src = "/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- the magic is HERE -->
    <script>
      $(function () {
        var socket = io();

        $('form').submit(function(e){
          e.preventDefault(); // prevents page reloading

          if($('#v').val() !== ''){   //If valid input
            socket.emit('video link', $('#v').val());
          }else{
            alert("Empty video!")
          }
          // if($('#m').val() == ''){  //to get textfield value "$('#id').val()"
          //   alert("empty message");
          // }else if($('#v').val() !== ''){
          //   socket.emit('video link', $('#v').val());
          // }else{
          //   console.log($('#m').val())  //Should print to browser because client side
          //   socket.emit('chat message', $('#m').val()); //take out of if, if this doesnt work
          // }

          // socket.emit('chat message', $('#m').val());
          $('#m').val('');  //Resets the textfield
          $('#v').val('');
          return false;
        });

        // $('form').submit(function(e){
        //   e.preventDefault(); // prevents page reloading
        //   socket.emit('chat message', $('#m').val());
        //   $('#m').val('');  //Resets the textfield
        //   return false;
        // });

        //Add more client side sockets here
        var rowNum = 1;
        socket.on('video link', (video) => {
          console.log(video); //Just pass the object to view it
          //alert(text(video));
          document.getElementById("ytvid").src = video + "?autoplay=1&loop=1";   //Rep. vid with input

          //Append to table
          var table = document.getElementById("myTableData");

          var link = video;
          if(link.length > 50){
            alert("Foh nga");
            return; //use this in real code -- leave along for testing purposes
          }
          var user = 'Update later';
          var song = "Update later";

          //Buttons
          var playAll = '<input type="button" value = "Play" onClick="Javacsript:playRow(this)">';  //Change to button
          var deleteButton = '<input type="button" value = "Delete" onClick="Javacsript:deleteRow(this)">';

          //Buttons need to retrieve data and (update database)
          var rowCount = table.rows.length;
          var row = table.insertRow(rowCount);

          let tableHeader2 = [rowNum,user, song, link, playAll, deleteButton]

          var i;
          for(i = 0; i < tableHeader2.length; i++){
              row.insertCell(i).innerHTML = tableHeader2[i];
          }
          rowNum++;
          document.getElementById("v").value = "";
          document.getElementById("v").focus();

        });

        socket.on('chat message', function(msg){
          $('#messages').append($('<li>').text(msg));
        });

        //Need to do something to delete row -- need to know how to pass around correct index/object to delete
        socket.on('delete row', function(row){
          // var index = row.parentNode.parentNode.rowIndex;   //Pass index for deletion
          var table = document.getElementById("myTableData");
          table.deleteRow(row);
          console.log("Deleting row: " + row);
        });
      }); //end of $function

      //Need to update this
      function deleteRow(obj) {
          //Test how sockets work
          var socket = io();
          var index = obj.parentNode.parentNode.rowIndex;
          socket.emit('delete row', index);
          //socket.emit('delete row', $('#v').val()); //I am able to do this <---
      }
    </script>


  </body>
</html>
